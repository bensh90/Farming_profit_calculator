<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>Pflanzen-Gewinnrechner</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    input, button { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    .block { margin-bottom: 20px; padding: 10px; background: white; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .buttonStyle { padding:6px 12px; background:#007bff; color:white; border-radius:4px; }
  </style>
</head>
<body>
  <h2>Pflanzen-Gewinnrechner</h2>  <div class="block">
    <label>Gesamtdauer (Tage): <input type="number" id="totalDays" value="30"></label>
    <label>Feldanzahl: <input type="number" id="totalFields" value="60"></label>
  </div>  <div class="block">
    <h3>Pflanze hinzufügen</h3>
    <label>Name: <input type="text" id="name"></label>
    <label>Kosten: <input type="number" id="cost"></label>
    <label>Verkaufspreis: <input type="number" id="sell"></label>
    <label>Tage bis Ernte: <input type="number" id="growTime"></label>
    <label>Regrow-Zyklus (0 = kein Regrow): <input type="number" id="regrow" value="0"></label>
    <label>Feldanteil (%): <input type="number" id="fieldShare" value="100"></label>
    <label for="season">Jahreszeit:</label>
    <select id="season">
      <option value="spring">Spring</option>
      <option value="summer">Summer</option>
      <option value="autumn">Autumn</option>
      <option value="winter">Winter</option>
    </select>
    <button class="buttonStyle" onclick="addPlantFromInput()">Hinzufügen</button>
  </div>  <div class="block">
    <h3>Daten Import/Export</h3>
    <button class="buttonStyle" onclick="exportPlants()">Pflanzen als JSON exportieren</button>
    <input type="file" id="fileInput" accept=".json" onchange="importPlants(event)" style="display:none">
    <label class="buttonStyle" for="fileInput" style="cursor:pointer;">
      JSON importieren
    </label>
    <br><br>
    <button class="buttonStyle" onclick="loadPreset('fields_of_mistria.json')">Preset: Fields of Mistria</button>
    <button class="buttonStyle" onclick="loadPreset('stardew_valley.json')">Preset: Stardew Valley</button>
  </div>  <div class="block">
    <h3>Pflanzenliste</h3>
    <label for="seasonFilter">Jahreszeit filtern:</label>
    <select id="seasonFilter" onchange="updateTable()">
      <option value="all">all</option>
      <option value="spring">Spring</option>
      <option value="summer">Summer</option>
      <option value="autumn">Autumn</option>
      <option value="winter">Winter</option>
    </select>
    <table id="plantTable">
      <tr>
        <th>Name</th><th>Felder</th><th>Ernten</th><th>Gewinn/Feld</th><th>Gesamtgewinn</th><th>Jahreszeit</th>
      </tr>
    </table>
    <p><strong>Gesamtgewinn aller Pflanzen: <span id="totalProfit">0</span></strong></p>
  </div>  <div class="block">
    <h3>Optimale Nutzung eines Felds</h3>
    <button style="buttonStyle" onclick="optimizeField()">Beste Kombination finden</button>
    <p id="bestCombo"></p>
  </div>  <script>
    let plants = [];

    function addPlantFromInput() {
      const data = {
        name: document.getElementById('name').value,
        cost: parseFloat(document.getElementById('cost').value),
        sell: parseFloat(document.getElementById('sell').value),
        growTime: parseInt(document.getElementById('growTime').value),
        regrow: parseInt(document.getElementById('regrow').value),
        fieldShare: parseFloat(document.getElementById('fieldShare').value),
        season: document.getElementById('season').value
      };
      addPlant(data);
    }

    function addPlant(data) {
      const totalFields = parseInt(document.getElementById('totalFields').value);
      const totalDays = parseInt(document.getElementById('totalDays').value);
      const fieldsUsed = Math.floor(totalFields * (data.fieldShare / 100));
    
      let harvests = 0;
      if (data.regrow > 0 && totalDays > data.growTime) {
        harvests = 1 + Math.floor((totalDays - data.growTime) / data.regrow);
      } else {
        harvests = Math.floor(totalDays / data.growTime);
      }
    
      const profitPerField = data.regrow > 0
        ? (harvests * data.sell) - data.cost
        : harvests * (data.sell - data.cost);
    
      const totalProfit = profitPerField * fieldsUsed;
    
      plants.push({ ...data, fieldsUsed, harvests, profitPerField, totalProfit });
      updateTable();
    }

    function updateTable() {
      const filter = document.getElementById('seasonFilter').value;
      const tbody = document.getElementById('plantTableBody');
      tbody.innerHTML = '';
    
      plants
        .filter(p => filter === 'all' || p.season === filter)
        .forEach(plant => {
          const row = tbody.insertRow();
          row.insertCell().textContent = plant.name;
          row.insertCell().textContent = plant.cost;
          row.insertCell().textContent = plant.sell;
          row.insertCell().textContent = plant.growTime;
          row.insertCell().textContent = plant.regrow;
          row.insertCell().textContent = plant.fieldShare + "%";
          row.insertCell().textContent = plant.harvests;
          row.insertCell().textContent = plant.profitPerField.toFixed(2);
          row.insertCell().textContent = plant.totalProfit.toFixed(2);
          row.insertCell().textContent = plant.season.charAt(0).toUpperCase() + plant.season.slice(1);
        });
    }

    function optimizeField() {
      const totalFields = parseInt(document.getElementById('totalFields').value);
      const totalDays = parseInt(document.getElementById('totalDays').value);
      const selectedSeason = document.getElementById('seasonFilter').value;
    
      const validPlants = plants.filter(p => selectedSeason === 'all' || p.season === selectedSeason);
    
      if (validPlants.length === 0) {
        alert("Keine gültigen Pflanzen für die gewählte Saison.");
        return;
      }
    
      let bestCombo = null;
      let maxProfit = -Infinity;
    
      for (let i = 0; i < validPlants.length; i++) {
        const p1 = validPlants[i];
        let harvests1 = (p1.regrow > 0 && totalDays > p1.growTime)
          ? 1 + Math.floor((totalDays - p1.growTime) / p1.regrow)
          : Math.floor(totalDays / p1.growTime);
    
        const usedDays = (p1.regrow > 0)
          ? totalDays
          : harvests1 * p1.growTime;
    
        const remainingDays = totalDays - usedDays;
    
        const profit1 = (p1.regrow > 0)
          ? (harvests1 * p1.sell - p1.cost)
          : harvests1 * (p1.sell - p1.cost);
    
        let bestSecond = null;
        let bestSecondProfit = 0;
    
        for (let j = 0; j < validPlants.length; j++) {
          const p2 = validPlants[j];
          if (p2 === p1 || p2.growTime > remainingDays) continue;
    
          const h2 = (p2.regrow > 0 && remainingDays > p2.growTime)
            ? 1 + Math.floor((remainingDays - p2.growTime) / p2.regrow)
            : Math.floor(remainingDays / p2.growTime);
    
          const profit2 = (p2.regrow > 0)
            ? (h2 * p2.sell - p2.cost)
            : h2 * (p2.sell - p2.cost);
    
          if (profit2 > bestSecondProfit) {
            bestSecond = p2;
            bestSecondProfit = profit2;
          }
        }

    const totalProfit = (profit1 + bestSecondProfit) * totalFields;

    if (totalProfit > maxProfit) {
      maxProfit = totalProfit;
      bestCombo = {
        primary: p1,
        secondary: bestSecond,
        profit: totalProfit
      };
    }
  }

  if (bestCombo) {
    alert(
      `Beste Kombination:\n` +
      `1. ${bestCombo.primary.name}\n` +
      (bestCombo.secondary ? `2. ${bestCombo.secondary.name}\n` : "") +
      `Ertrag: ${bestCombo.profit.toFixed(2)}`
    );
  } else {
    alert("Keine Kombination gefunden.");
  }
}

    function exportPlants() {
      const data = plants.map(p => ({
        name: p.name,
        cost: p.cost,
        sell: p.sell,
        growTime: p.growTime,
        regrow: p.regrow,
        fieldShare: (p.fieldsUsed / parseInt(document.getElementById('totalFields').value)) * 100,
        season: p.season
      }));
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pflanzen.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importPlants(event) {
      const file = event.target.files[0];
      if (!file) return;
    
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          plants = [];
          updateTable();
          data.forEach(p => addPlant(p));
        } catch (err) {
          alert("Fehler beim Laden der Datei.");
        }
      };
      reader.readAsText(file);
    }

    function loadPreset(filename) {
      fetch(filename)
        .then(res => res.json())
        .then(data => {
          plants = [];
          updateTable();
          data.forEach(p => addPlant(p));
        })
        .catch(() => alert("Preset konnte nicht geladen werden."));
    }
  </script></body>
</html>
